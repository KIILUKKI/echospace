<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MiniChat</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}
body{margin:0;height:100vh;font-family:Inter,sans-serif;background:#0b0f14;color:#e6edf3}
#app{width:100%;height:100%;position:relative}

/* LOGIN */
#login{
position:absolute;inset:0;
display:flex;flex-direction:column;
justify-content:center;align-items:center;
gap:12px;background:#0b0f14;z-index:10
}
#login input{
width:260px;padding:14px;
border-radius:10px;border:none;
background:#21262d;color:#fff
}
#login button{
padding:14px 28px;border-radius:12px;
background:#58a6ff;color:#000;
border:none;font-weight:600;cursor:pointer
}

/* HOME */
#home{
position:absolute;inset:0;
display:none;               /* ← KORJATTU */
background:#0b0f14;
}
#homeLeft{
width:260px;height:100%;
background:#161b22;padding:14px;
overflow-y:auto;border-right:1px solid #0d1117
}
.room{
padding:10px 12px;border-radius:8px;
background:#21262d;margin-bottom:8px;
cursor:pointer
}
.room:hover{background:#58a6ff;color:#000}
#homeCenter{
flex:1;display:flex;flex-direction:column;
justify-content:center;align-items:center
}
#nickRow{display:flex;gap:12px;width:320px;margin-bottom:20px}
#nick{flex:1;padding:12px;border-radius:10px;border:none;background:#21262d;color:#fff}
#nickColor{width:42px;height:42px;border:none}
#createRoom{
padding:14px 28px;border-radius:12px;
background:#58a6ff;color:#000;
border:none;font-weight:600;cursor:pointer
}

/* MAIN */
#main{
display:none;
height:100%;
flex-direction:column;
}

/* CHAT */
#chatWrapper{flex:1;display:flex;overflow:hidden}
#chatSidebar{
width:260px;background:#161b22;
border-right:1px solid #0d1117
}
#chatWrapperMain{flex:1;display:flex;flex-direction:column}

/* HEADER */
#header{
height:52px;background:#161b22;
display:flex;align-items:center;
padding:0 14px;border-bottom:1px solid #0d1117
}
#header button{
background:none;border:none;color:#fff;
font-size:18px;cursor:pointer;margin-right:10px
}

/* CHAT */
#chat{
flex:1;padding:16px;
overflow-y:auto;
display:flex;
flex-direction:column;
gap:10px
}
.message{display:flex;gap:10px}
.avatar{
width:36px;height:36px;border-radius:50%;
display:flex;align-items:center;justify-content:center;
font-weight:600;color:#000
}
.msg{
background:#161b22;padding:10px 14px;
border-radius:10px;width:100%
}

/* INPUT */
#inputBar{
padding:14px;background:#161b22;
border-top:1px solid #0d1117;
display:flex;gap:8px
}
#msg{
flex:1;padding:12px;border-radius:8px;
border:none;background:#0d1117;color:#fff
}
</style>
</head>

<body>
<div id="app">

<div id="login">
<h2>Login</h2>
<input id="loginNick" placeholder="Username">
<input id="loginPass" type="password" placeholder="Password">
<button id="loginBtn">Login / Register</button>
</div>

<div id="home">
<div id="homeLeft">
<h2>Rooms</h2>
<div id="roomList"></div>
</div>
<div id="homeCenter">
<div id="nickRow">
<input id="nick" placeholder="Username">
<input type="color" id="nickColor" value="#58a6ff">
</div>
<button id="createRoom">Create / Join Room</button>
</div>
</div>

<div id="main">
<div id="header">
<button id="back">←</button>
<span id="roomName"></span>
</div>

<div id="chatWrapper">
<div id="chatSidebar"></div>
<div id="chatWrapperMain">
<div id="chat"></div>
</div>
</div>

<div id="inputBar">
<input id="msg" placeholder="Message...">
</div>
</div>

</div>

<script>
const login = document.getElementById("login");
const home = document.getElementById("home");
const main = document.getElementById("main");

const loginBtn = document.getElementById("loginBtn");
const loginNick = document.getElementById("loginNick");

const roomList = document.getElementById("roomList");
const createRoomBtn = document.getElementById("createRoom");

const chat = document.getElementById("chat");
const msgInput = document.getElementById("msg");
const roomNameEl = document.getElementById("roomName");
const backBtn = document.getElementById("back");

let user = "";
let currentRoom = "";

const getRooms = () =>
  JSON.parse(localStorage.getItem("rooms") || "[]");

const saveRooms = r =>
  localStorage.setItem("rooms", JSON.stringify(r));

loginBtn.onclick = () => {
  if (!loginNick.value.trim()) return;
  user = loginNick.value.trim();
  login.style.display = "none";
  home.style.display = "flex";      /* ← VARMA */
  renderRooms();
};

function renderRooms() {
  roomList.innerHTML = "";
  getRooms().forEach(room => {
    const div = document.createElement("div");
    div.className = "room";
    div.textContent = room;
    div.onclick = () => enterRoom(room);
    roomList.appendChild(div);
  });
}

createRoomBtn.onclick = () => {
  const name = prompt("Room name?");
  if (!name) return;
  const rooms = getRooms();
  if (!rooms.includes(name)) {
    rooms.push(name);
    saveRooms(rooms);
  }
  renderRooms();
};

function enterRoom(room) {
  currentRoom = room;
  roomNameEl.textContent = room;
  home.style.display = "none";
  main.style.display = "flex";      /* ← TÄRKEÄ */
  loadMessages();
}

backBtn.onclick = () => {
  main.style.display = "none";
  home.style.display = "flex";
};

function loadMessages() {
  chat.innerHTML = "";
  const msgs = JSON.parse(
    localStorage.getItem("chat_" + currentRoom) || "[]"
  );
  msgs.forEach(m => {
    const div = document.createElement("div");
    div.textContent = m.user + ": " + m.text;
    chat.appendChild(div);
  });
}

msgInput.addEventListener("keydown", e => {
  if (e.key === "Enter" && msgInput.value.trim()) {
    const key = "chat_" + currentRoom;
    const msgs = JSON.parse(localStorage.getItem(key) || "[]");
    msgs.push({ user, text: msgInput.value });
    localStorage.setItem(key, JSON.stringify(msgs));
    msgInput.value = "";
    loadMessages();
  }
});
</script>
</body>
</html>
