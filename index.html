<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MiniChat</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}
body{margin:0;height:100vh;font-family:Inter,sans-serif;background:#0b0f14;color:#e6edf3}
#app{width:100%;height:100%;position:relative}

/* LOGIN */
#login{
position:absolute;inset:0;
display:flex;flex-direction:column;
justify-content:center;align-items:center;
gap:12px;background:#0b0f14;z-index:10
}
#login input{
width:260px;padding:14px;
border-radius:10px;border:none;
background:#21262d;color:#fff
}
#login button{
padding:14px 28px;border-radius:12px;
background:#58a6ff;color:#000;
border:none;font-weight:600;cursor:pointer
}

/* HOME */
#home{position:absolute;inset:0;display:none;background:#0b0f14}
#homeLeft{
width:260px;height:100%;
background:#161b22;padding:14px;
overflow-y:auto;border-right:1px solid #0d1117
}
#homeLeft h2{margin:0 0 14px}
.room{
padding:10px 12px;border-radius:8px;
background:#21262d;margin-bottom:8px;
cursor:pointer
}
.room:hover{background:#58a6ff;color:#000}
#homeCenter{
flex:1;display:flex;flex-direction:column;
justify-content:center;align-items:center
}
#nickRow{display:flex;gap:12px;width:320px;margin-bottom:20px}
#nick{flex:1;padding:12px;border-radius:10px;border:none;background:#21262d;color:#fff}
#nickColor{width:42px;height:42px;border:none}
#createRoom{
padding:14px 28px;border-radius:12px;
background:#58a6ff;color:#000;
border:none;font-weight:600;cursor:pointer
}

/* MAIN */
#main{display:none;height:100%;flex-direction:column}
#header{
height:52px;background:#161b22;
display:flex;align-items:center;
padding:0 14px;border-bottom:1px solid #0d1117
}
#header button{
background:none;border:none;color:#fff;
font-size:18px;cursor:pointer;margin-right:10px
}
#chatWrapper{display:flex;flex:1;overflow:hidden}
#chatSidebar{width:260px;background:#161b22;border-right:1px solid #0d1117}
#chatWrapperMain{flex:1;display:flex;flex-direction:column}
#chat{
flex:1;padding:16px;overflow-y:auto;
display:flex;flex-direction:column;gap:10px
}
.message{display:flex;gap:10px}
.avatar{
width:36px;height:36px;border-radius:50%;
display:flex;align-items:center;justify-content:center;
font-weight:600;color:#000
}
.msg{
background:#161b22;padding:10px 14px;
border-radius:10px;width:100%;position:relative
}
.time{font-size:11px;color:#8b949e;margin-left:6px}
.reply-btn{
position:absolute;right:8px;top:8px;
font-size:12px;color:#8b949e;
cursor:pointer;opacity:0
}
.msg:hover .reply-btn{opacity:1}
.reply-preview{
background:#0d1117;border-left:3px solid #58a6ff;
padding:6px;font-size:12px;margin-bottom:6px
}
#replyBox{display:none;background:#21262d;padding:8px 14px;font-size:12px;color:#fff}
#replyBox span{color:#58a6ff}
#inputBar{
padding:14px;background:#161b22;
border-top:1px solid #0d1117;
display:flex;gap:8px;position:relative;align-items:center
}
#msg{flex:1;padding:12px;border-radius:8px;border:none;background:#0d1117;color:#fff}
#emojiPicker{
display:none;flex-wrap:wrap;gap:4px;
padding:6px;background:#21262d;
border-radius:8px;position:absolute;
bottom:60px;left:14px;
max-width:320px;max-height:200px;overflow-y:auto
}
#emojiPicker div{cursor:pointer;font-size:18px}
#emojiBtn{border:none;background:#161b22;color:#fff;font-size:18px;cursor:pointer}
#typingIndicator{font-size:12px;color:#8b949e;margin-left:16px}
</style>
</head>

<body>
<div id="app">

<div id="login">
<h2>Login</h2>
<input id="loginNick" placeholder="Username">
<input id="loginPass" type="password" placeholder="Password">
<button id="loginBtn">Login / Register</button>
</div>

<div id="home">
<div id="homeLeft">
<h2>Rooms</h2>
<div id="roomList"></div>
</div>
<div id="homeCenter">
<div id="nickRow">
<input id="nick" placeholder="Username">
<input type="color" id="nickColor" value="#58a6ff">
</div>
<button id="createRoom">Create / Join Room</button>
</div>
</div>

<div id="main">
<div id="header">
<button id="back">‚Üê</button>
<span id="roomName"></span>
</div>

<div id="chatWrapper">
<div id="chatSidebar"></div>
<div id="chatWrapperMain">
<div id="chat"></div>
<div id="typingIndicator"></div>
</div>
</div>

<div id="replyBox"></div>
<div id="inputBar">
<button id="emojiBtn">üòä</button>
<input id="msg" placeholder="Message... (/clear /delete)">
<div id="emojiPicker"></div>
</div>
</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
getFirestore, doc, getDoc, setDoc, collection,
addDoc, getDocs, query, orderBy,
onSnapshot, serverTimestamp, deleteDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const app = initializeApp({
apiKey:"AIzaSyDbYLUXJjHQ-V5uFvtyzwq-IwIKM7xTcyc",
projectId:"chat-fc8ef"
});
const db = getFirestore(app);

/* LOGIN */
const login=document.getElementById("login");
const home=document.getElementById("home");
const main=document.getElementById("main");
const loginNick=document.getElementById("loginNick");
const loginPass=document.getElementById("loginPass");
const loginBtn=document.getElementById("loginBtn");

let nick="", room="", replyTo=null;

loginBtn.onclick=()=>{
const n=loginNick.value.trim();
const p=loginPass.value;
if(!n||!p) return alert("Fill fields");

const users=JSON.parse(localStorage.getItem("users")||"{}");
if(users[n]){
if(users[n]!==p) return alert("Wrong password");
}else{
users[n]=p;
localStorage.setItem("users",JSON.stringify(users));
}

nick=n;
document.getElementById("nick").value=n;
login.style.display="none";
home.style.display="flex";
loadRooms();
};

/* --- t√§st√§ alasp√§in chat-koodi on t√§ysin sama kuin sinulla --- */

const chat=document.getElementById("chat");
const msg=document.getElementById("msg");
const roomList=document.getElementById("roomList");
const replyBox=document.getElementById("replyBox");
const roomName=document.getElementById("roomName");
const emojiPicker=document.getElementById("emojiPicker");
const emojiBtn=document.getElementById("emojiBtn");
const typingIndicator=document.getElementById("typingIndicator");
const nickInput=document.getElementById("nick");
const nickColorInput=document.getElementById("nickColor");

async function loadRooms(){
roomList.innerHTML="";
const s=await getDocs(collection(db,"rooms"));
s.forEach(r=>{
const d=document.createElement("div");
d.className="room";
d.textContent="# "+r.id;
d.onclick=()=>joinRoom(r.id);
roomList.appendChild(d);
});
}

back.onclick=()=>location.reload();
</script>
</body>
</html>
